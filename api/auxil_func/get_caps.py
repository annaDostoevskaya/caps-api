from api.models import Cap
from api import DBSession

def calc_pointer_id_in_db(page: int, pg_size: int) -> int:
    '''
    Example:

    page = 2. pg_size = 3. => pointer_id = 4 <----+------------------------------------------------+
                                                  +                                                +
        pointer_id = ((page - 1) * pg_size) + 1 <-+                                                +
                                                  +                                                +
        (page - 1) -------------------------------+------------------------------------+           +
                                                  +                                    +           +
+------ (page - 1) * pg_size                      +                                    +           +
+                                                 +                                    +           +
+       (page - 1) * pg_size + 1------------------+                                    +           +
+                                                                                      +           +
+               +-1. =DATA=========================================== -+               +           +
+   pg_size = 3 + 2. =DATA===========================================  + page = 1  <---+           +
+----------->   +-3. =DATA=========================================== -+                           +
                                                                                                   +
                  4. =DATA=========================================== -+ <-------------------------+
                  5. =DATA===========================================  + page = 2
                  6. =DATA=========================================== -+

                  7. =DATA=========================================== -+
                  8. =DATA===========================================  + page = 3
                  9. =DATA=========================================== -+

                  10.=DATA=========================================== -+
                  .....................................................+ page = 4

    '''
    return ((page - 1) * pg_size) + 1

def get_caps_db_request(pointer_id: int, pg_size: int) -> list[Cap]:
    with DBSession() as sess:
        caps = sess.query(Cap).filter(Cap.id >= pointer_id, Cap.id < pointer_id + pg_size).all()
    return caps